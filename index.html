<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Sweet Bonanza Mini App</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  margin:0;
  background: linear-gradient(180deg,#ffb6e6,#8b5cf6);
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  font-family: 'Segoe UI', sans-serif;
  overflow: hidden;
}
.game-container {
  text-align:center;
  background: rgba(255,255,255,0.05);
  padding: 1rem 1.5rem;
  border-radius: 1rem;
  box-shadow:0 0 30px rgba(0,0,0,0.3);
}
.grid-container {
  display: grid;
  grid-template-columns: repeat(6, 60px);
  grid-template-rows: repeat(5, 60px);
  gap:5px;
  margin: 1rem auto;
  background: rgba(255,255,255,0.15);
  border-radius:1rem;
  padding:5px;
  position: relative;
  overflow: hidden;
}
.cell {
  display:flex;
  justify-content:center;
  align-items:center;
  background: rgba(255,255,255,0.2);
  border-radius:10px;
  transition: transform 0.5s, opacity 0.5s;
  position: relative;
}
.cell.win {
  animation: pop 0.5s ease forwards;
}
@keyframes pop {
  0% { transform: scale(1); opacity:1; }
  50% { transform: scale(1.5); opacity:1; }
  100% { transform: scale(1); opacity:1; }
}
.cell img {
  width:50px;
  height:50px;
}
.buttons { margin-top:10px; }
.buttons button {
  margin:5px;
  padding:10px 20px;
  border:none;
  border-radius:10px;
  font-weight:bold;
  color:white;
  cursor:pointer;
  box-shadow:0 0 10px rgba(0,0,0,0.3);
}
.spin { background:#ff3b9c; }
.bonus { background:#ffce00; color:#333; }
.info {
  color:white;
  font-weight:bold;
  margin-top:8px;
}
</style>
</head>
<body>
<div class="game-container">
  <div class="grid-container" id="grid"></div>
  <div class="buttons">
    <button class="spin" onclick="spinGame()">SPIN</button>
    <button class="bonus" onclick="buyBonus()">BUY BONUS 100x</button>
  </div>
  <div class="info" id="info"></div>
</div>

<script>
// =======================
// –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–≥—Ä—ã
// =======================
const ROWS = 5;
const COLS = 6;

// PNG —Å–∏–º–≤–æ–ª—ã
const SYMBOLS = {
  "üçé":"https://i.ibb.co/7Cz9yT9/apple.png",
  "üçá":"https://i.ibb.co/pRZV7Xb/grape.png",
  "üçâ":"https://i.ibb.co/k6yL7K3/watermelon.png",
  "üçë":"https://i.ibb.co/NL4WxJP/peach.png",
  "üçí":"https://i.ibb.co/fktsfZ9/cherry.png",
  "üç¨":"https://i.ibb.co/9rS0wzB/candy.png",
  "üç≠":"https://i.ibb.co/mvP3YZX/lollipop.png",
  "üçå":"https://i.ibb.co/2h7Jr4p/banana.png",
  "üçã":"https://i.ibb.co/K9m9mh2/lemon.png",
  "üçç":"https://i.ibb.co/SfJtXcF/pineapple.png"
};

const FRUITS_ONLY = ["üçé","üçá","üçâ","üçë","üçí","üç¨"];

const PAYTABLE = {
  "üç¨":[4,10,20],
  "üçé":[1.5,2,10],
  "üçá":[0.8,1.2,8],
  "üçâ":[0.5,1,5],
  "üçë":[0.4,0.9,4],
  "üçí":[0.25,0.75,2],
  "üçå":[1,1,1],
  "üçã":[1,1,1],
  "üçç":[1,1,1]
};

let balance = 1000;
let bet = 10;
let freeSpins = 0;
let grid = [];

// =======================
// –§—É–Ω–∫—Ü–∏–∏
// =======================
function randSymbol() {
  const keys = Object.keys(SYMBOLS);
  return keys[Math.floor(Math.random()*keys.length)];
}

function createGrid(){
  const gridDiv = document.getElementById('grid');
  gridDiv.innerHTML='';
  for(let i=0;i<ROWS*COLS;i++){
    const cell = document.createElement('div');
    cell.className='cell';
    const img = document.createElement('img');
    img.src=SYMBOLS[grid[i]];
    cell.appendChild(img);
    gridDiv.appendChild(cell);
  }
  updateInfo();
}

function updateInfo(){
  document.getElementById('info').textContent=`Balance: ${balance} | Bet: ${bet} | Free Spins: ${freeSpins}`;
}

function animateWin(indices){
  indices.forEach(i=>{
    const cellDiv = document.getElementById('grid').children[i];
    cellDiv.classList.add('win');
    setTimeout(()=>cellDiv.classList.remove('win'),500);
  });
}

// =======================
// SPIN
// =======================
function spinGame(){
  if(balance<bet && freeSpins===0){ alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!"); return; }
  if(freeSpins>0){ freeSpins--; } else { balance-=bet; }

  grid = [];
  for(let i=0;i<ROWS*COLS;i++){
    grid.push(randSymbol());
  }
  createGrid();

  setTimeout(()=>tumble(),500);
}

// =======================
// TUMBLE
// =======================
function tumble(){
  let winCells = [];
  let totalWin = 0;
  let mults = [];

  FRUITS_ONLY.forEach(f=>{
    let cnt = grid.filter(x=>x===f).length;
    if(cnt>=8){
      let idx=0; if(cnt>=10) idx=1; if(cnt>=12) idx=2;
      totalWin += bet*PAYTABLE[f][idx];
      grid.forEach((x,i)=>{ if(x===f) winCells.push(i); });
    }
  });

  // –ú—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä—ã –±–æ–º–±—ã 30% —à–∞–Ω—Å
  if(Math.random()<0.3){
    const multValues=[2,5,10,25,50,100];
    const multWeights=[400,250,120,40,8,2];
    const totalWeight = multWeights.reduce((a,b)=>a+b,0);
    let rand=Math.random()*totalWeight;
    let val=2;
    for(let i=0;i<multValues.length;i++){
      if(rand<multWeights[i]){val=multValues[i]; break;}
      rand-=multWeights[i];
    }
    totalWin*=val;
    mults.push(val);
  }

  animateWin(winCells);
  balance += totalWin;

  let scatters = grid.filter(x=>"üç≠"===x).length;
  if(freeSpins===0 && scatters>=4){
    freeSpins+=10;
    alert("üéâ BONUS TRIGGERED! 10 Free Spins!");
  }

  // Smooth Tumble: –∑–∞–º–µ–Ω—è–µ–º –≤—ã–∏–≥—Ä–∞–≤—à–∏–µ –∫–ª–µ—Ç–∫–∏ –Ω–æ–≤—ã–º–∏
  winCells.forEach(i=>{
    grid[i]=randSymbol();
  });

  createGrid();

  if(winCells.length>0){
    setTimeout(tumble,500);
  }
}

// =======================
// BUY BONUS
// =======================
function buyBonus(){
  let cost = bet*100;
  if(balance<cost){ alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!"); return; }
  balance -= cost;
  freeSpins+=10;
  updateInfo();
  alert("üéÅ –ö—É–ø–ª–µ–Ω–æ 10 Free Spins!");
}

// =======================
// INIT
// =======================
for(let i=0;i<ROWS*COLS;i++){
  grid.push(randSymbol());
}
createGrid();
</script>
</body>
</html>
